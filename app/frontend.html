<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generated Page</title>
    <link rel="stylesheet" href="frontend.css">
</head>
<body>
    <div id="page-container" class="page-container">
        <!-- Content loaded dynamically -->
    </div>
    
    <div class="controls">
        <button id="refreshBtn" class="control-btn" title="Refresh">
            <i class="fas fa-sync-alt"></i>
        </button>
        <button id="openEditorBtn" class="control-btn" title="Open Editor">
            <i class="fas fa-edit"></i>
        </button>
        <button id="fullscreenBtn" class="control-btn" title="Fullscreen">
            <i class="fas fa-expand"></i>
        </button>
    </div>

    <script>
        function loadPage() {
            const html = localStorage.getItem('generatedPageHTML');
            const container = document.getElementById('page-container');
            
            if (html && html.trim() !== '') {
                // Clear container
                container.innerHTML = '';
                
                // Create iframe to load the generated HTML
                const iframe = document.createElement('iframe');
                iframe.style.cssText = `
                    width: 100%;
                    height: 100%;
                    border: none;
                    position: fixed;
                    top: 0;
                    left: 0;
                    z-index: 1;
                `;
                container.appendChild(iframe);
                
                // Write HTML to iframe
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                iframeDoc.open();
                iframeDoc.write(html);
                iframeDoc.close();
                
                console.log('Page loaded successfully');
            } else {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-content">
                            <i class="fas fa-paint-brush"></i>
                            <h2>No page created yet</h2>
                            <p>Open the editor and click "Apply Changes"</p>
                            <button onclick="window.open('backend.html', '_blank')" class="btn">
                                <i class="fas fa-edit"></i> Open Editor
                            </button>
                        </div>
                    </div>
                `;
            }
        }
        
        function setupControls() {
            const refreshBtn = document.getElementById('refreshBtn');
            const openEditorBtn = document.getElementById('openEditorBtn');
            const fullscreenBtn = document.getElementById('fullscreenBtn');
            
            if (refreshBtn) {
                refreshBtn.addEventListener('click', function() {
                    loadPage();
                    showNotification('Page refreshed');
                });
            }
            
            if (openEditorBtn) {
                openEditorBtn.addEventListener('click', function() {
                    window.open('backend.html', '_blank');
                });
            }
            
            if (fullscreenBtn) {
                fullscreenBtn.addEventListener('click', function() {
                    if (!document.fullscreenElement) {
                        document.documentElement.requestFullscreen();
                        this.innerHTML = '<i class="fas fa-compress"></i>';
                    } else {
                        document.exitFullscreen();
                        this.innerHTML = '<i class="fas fa-expand"></i>';
                    }
                });
            }
            
            // Listen for storage updates
            window.addEventListener('storage', function(e) {
                if (e.key === 'generatedPageHTML' || e.key === 'lastUpdate') {
                    console.log('Storage updated, refreshing...');
                    setTimeout(loadPage, 100);
                }
            });
            
            // Auto-refresh every 2 seconds
            setInterval(function() {
                const lastUpdate = localStorage.getItem('lastUpdate');
                if (window.lastUpdateTime !== lastUpdate) {
                    window.lastUpdateTime = lastUpdate;
                    loadPage();
                }
            }, 2000);
        }
        
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                bottom: 80px;
                right: 20px;
                background: #2ecc71;
                color: white;
                padding: 12px 20px;
                border-radius: 5px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 10000;
                font-weight: bold;
                animation: fadeIn 0.5s;
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transition = 'opacity 0.5s';
                setTimeout(() => notification.remove(), 500);
            }, 3000);
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            window.lastUpdateTime = localStorage.getItem('lastUpdate');
            loadPage();
            setupControls();
            
            // Check for presentation mode
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('presentation')) {
                document.querySelector('.controls').style.display = 'none';
                document.documentElement.requestFullscreen();
            }
        });
    </script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .empty-state {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
        }
        
        .empty-content {
            text-align: center;
            padding: 40px;
        }
        
        .empty-content i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.7;
        }
        
        .empty-content h2 {
            margin-bottom: 10px;
            color: #ecf0f1;
        }
        
        .empty-content p {
            margin-bottom: 25px;
            color: #bdc3c7;
        }
        
        .empty-content .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            background-color: #3498db;
            color: white;
            text-decoration: none;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .empty-content .btn:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }
    </style>
</body>
</html>